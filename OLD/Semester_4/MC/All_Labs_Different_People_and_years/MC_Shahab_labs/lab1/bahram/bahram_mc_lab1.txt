/*---------------------------------------------------------------------------------------
 * Testprogram:  PortD Leds on/off
 *                  Print "MP-Labor" on console
 *                                                                          Prosch 3/2014
 *---------------------------------------------------------------------------------------
 */
#define  PART_LM3S9B92




// IE4, MC_Lab1 , KeybEncoder
// Ahmed Attia &&  Bahram Samavatian,  group 03-A , 07.04.2015
//-------------------------------------------------------//
#include <stdio.h>
#include "inc/lm3s9b92.h" // defines all registers
// Defining the buttons of the KeybEncoder
char key[4][4] = {
{ '1', '2', '3', 'F' },
{ '4', '5', '6', 'E' },
{ '7', '8', '9', 'D' },
{ 'A', '0', 'B', 'C' } };
// Configuration of ports and system clock
void config() {
    // Port  Clock Gating Control
    SYSCTL_RCGC2_R |= ((1 << 3) | (1 << 8)); // enabling clock for Port D & J
    // Configuration of ports D and J
    GPIO_PORTD_DEN_R = 0x0F;    // Enabling Port D
    GPIO_PORTD_DIR_R = 0x0F;    // set bits 0 to 3 of Port D as outputs
    GPIO_PORTJ_DEN_R = 0x0F;      // Enabling Port J
    GPIO_PORTJ_DIR_R = 0x00;     // set bits 0 to 3 of Port J as inputs
}
// delay function
void waitLoop() {
    int delay;
    for (delay = 0; delay < 100; delay++)
        ;
}
// Main function
void main() {
    int row, col,count;
    char value;
    printf("Press a key :\n");
    config();
    while (1) {
    	count=0;
        for (col = 0; col < 4; col++) { // iterating through the columns

            GPIO_PORTD_DATA_R = 0x0F ^ (0x01 << col);
            waitLoop(); // delay
            for (row = 0; row < 4; row++) { // iterating through the rows
                if (!(GPIO_PORTJ_DATA_R & (0x01 << row))) // expression will evaluate to true
                {
                    count++;
                    if (value!=key[row][col])
                printf("- %c\n", key[row][col]);
                value=key[row][col];
                break;
                }
            }

        }

        if (count==0)
            value='q';
    }
}

